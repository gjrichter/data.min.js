/*
 CC BY SA
 @license MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(f,m,l){f instanceof String&&(f=String(f));for(var q=f.length,t=0;t<q;t++){var g=f[t];if(m.call(l,g,t,f))return{i:t,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,m,l){f!=Array.prototype&&f!=Object.prototype&&(f[m]=l.value)};
$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(f,m,l,q){if(m){l=$jscomp.global;f=f.split(".");for(q=0;q<f.length-1;q++){var t=f[q];t in l||(l[t]={});l=l[t]}f=f[f.length-1];q=l[f];m=m(q);m!=q&&null!=m&&$jscomp.defineProperty(l,f,{configurable:!0,writable:!0,value:m})}};
$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(f,l){return $jscomp.findInternal(this,f,l).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var f=0;return function(m){return $jscomp.SYMBOL_PREFIX+(m||"")+f++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var m=0;return $jscomp.iteratorPrototype(function(){return m<f.length?{done:!1,value:f[m++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,m){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var l=0,q={next:function(){if(l<f.length){var t=l++;return{value:m(t,f[t]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};
$jscomp.polyfill("Array.prototype.values",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(f,l){return l})}},"es6","es3");
(function(f,m,l){function q(){var a=f.Data;g.noConflict=function(){f.Data=a;return this};f.Data=g}var t=new Date;_LOG=function(a){console.log("_LOG: time[sec.ms] "+(new Date-t)/1E3+" "+a)};__isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};__toArray=function(a){return a&&"undefined"!=typeof a?__isArray(a)?a:String(a).match(/\|/)?String(a).split("|"):String(a).split(","):[]};__onlyUnique=function(a,b,c){return c.indexOf(a)===b};var g={version:"1.47",errors:[]};"object"===
typeof module&&"object"===typeof module.exports?module.exports=g:"function"===typeof define&&define.amd&&define(g);"undefined"!==typeof f&&q();g.Object=function(a){this.options=a;this.debug=!1};g.Object.prototype={import:function(a){this.options.success=a;this.feed=g.feed({});this.feed.options=this.options;"csv"==this.options.type||"CSV"==this.options.type?this.feed.__processCSVData(this.options.source,this.options):"rss"==this.options.type||"RSS"==this.options.type?(this.options.format="xml",this.feed.__processRSSData(this.options.source,
this.options)):"kml"==this.options.type||"KML"==this.options.type?(this.options.format="xml",this.feed.__processKMLData(this.options.source,this.options)):"json"==this.options.type||"JSON"==this.options.type||"Json"==this.options.type?this.feed.__processJsonData(this.options.source,this.options):"geojson"==this.options.type||"GEOJSON"==this.options.type||"GeoJson"==this.options.type?this.feed.__processGeoJsonData(this.options.source,this.options):"topojson"==this.options.type||"TOPOJSON"==this.options.type||
"TopoJson"==this.options.type?this.feed.__processTopoJsonData(this.options.source,this.options):("jsonDB"==this.options.type||"JSONDB"==this.options.type||"JsonDB"==this.options.type||"jsondb"==this.options.type)&&this.feed.__processJsonDBData(this.options.source,this.options);return this},error:function(a){this.options.error=a;return this}};g.Import=function(a){this.options=a;this.debug=!1};g.Feed=function(a){this.options=a||{};this.debug=!1;this.options.error=function(a){g.errors.push(a)}};g.Feed.prototype=
{load:function(a){this.options.success=a;var b=this.options,c=b.source||b.src||b.url||b.ext;"undefined"===typeof b.cache&&(b.cache=!0,b.options&&"undefined"!==typeof b.options.cache&&(b.cache=b.options.cache));var d=this;c||r("Data.feed(...).load(): no source defined !",2E3);"csv"==b.type||"CSV"==b.type?this.__doCSVImport(c,b):"rss"==b.type||"RSS"==b.type?this.__doRSSImport(c,b):"kml"==b.type||"KML"==b.type?this.__doKMLImport(c,b):"json"==b.type||"JSON"==b.type||"Json"==b.type?this.__doJSONImport(c,
b):"geojson"==b.type||"GEOJSON"==b.type||"GeoJson"==b.type?this.__doGeoJSONImport(c,b):"topojson"==b.type||"TOPOJSON"==b.type||"TopoJson"==b.type?this.__doTopoJSONImport(c,b):"jsonDB"==b.type||"JSONDB"==b.type||"JsonDB"==b.type||"jsondb"==b.type?this.__doJsonDBImport(c,b):"jsonstat"==b.type||"jsonStat"==b.type||"JSONSTAT"==b.type?$.getScript("http://json-stat.org/lib/json-stat.js").done(function(a,e){d.__doLoadJSONstat(c,b)}).fail(function(a,c,d){r("'"+b.type+"' unknown format !")}):r("'"+b.type+
"' unknown format !");return this},error:function(a){this.options.error=a;return this}};g.feed=function(a){return new g.Feed(a)};g.object=function(a){return new g.Object(a)};g.import=function(a){return(new g.Object(a)).import().feed.dbtable};g.Feed.prototype.__doLoadJSONstat=function(a,b){var c=this;JSONstat(a,function(){var a=[],h=[this.Dataset(0).Dimension(0).label],e=this.Dataset(0).Dimension(1).id;for(g=0;g<e.length;g++)h.push(this.Dataset(0).Dimension(1).Category(e[g]).label);a.push(h);for(var g=
0;g<this.Dataset(0).Dimension(0).length;g++){h=[];h.push(this.Dataset(0).Dimension(0).Category(this.Dataset(0).Dimension(0).id[g]).label);for(e=0;e<this.Dataset(0).Dimension(1).length;e++)h.push(this.Dataset(0).Data([g,e]).value);a.push(h)}b.callback?b.callback(a,b):c.__createDataTableObject(a,b.type,b)})};g.Feed.prototype.__doJsonDBImport=function(a,b){_LOG("__doJsonDBImport: "+a);var c=this;b.url=a;$.getScript(a+".gz").done(function(a,h){c.__processJsonDBData(a,b)}).fail(function(d,h,e){$.getScript(a).done(function(a,
d){c.__processJsonDBData(a,b)}).fail(function(b,d,e){c.options.error&&c.options.error('"'+a+'" '+e)})})};g.Feed.prototype.__processJsonDBData=function(a,b){_LOG("__processJsonDBData:");this.dbtable=new g.Table;"string"==typeof a?(a=b.source.split(/\//).pop(),a=a.split(/\./)[0],a=eval(a)):a=b.source;this.dbtable.table=a.table;this.dbtable.fields=a.fields;this.dbtable.records=a.records;b.callback?b.callback(newData,b):"undefined"!=typeof b&&b.success&&b.success(this.dbtable)};g.Feed.prototype.__doCSVImport=
function(a,b){_LOG("__doCSVImport: "+a);var c=this;$.ajax({type:"GET",url:a,cache:b.cache,dataType:"text",success:function(a){c.__processCSVData(a,b)},error:function(c,h,e){"undefined"!=typeof b&&b.error&&b.error('"'+a+'" '+e)}})};g.Feed.prototype.__processCSVData=function(a,b){if("undefined"==typeof Papa)_LOG("__processCSVData:load csv parser!"),__this=this,$.getScript("https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js").done(function(c,h){__this.__processCSVData(a,b)}).fail(function(a,
c,e){r("'"+b.type+"' parser not loaded !")});else{var c=Papa.parse(a,b.parser).data;if("undefined"==typeof c[0]||"undefined"==typeof c[1])return r(c),b.error&&b.error(c),!1;b.parser&&b.parser.delimiter||c[0].length==c[1].length||(_LOG("csv parser: autodetect failed"),_LOG("csv parser: delimiter = ;"),c=Papa.parse(a,{delimiter:";"}).data,c[0].length!=c[1].length&&(_LOG("csv parser: delimiter = ; failed"),_LOG("csv parser: delimiter = ,"),c=Papa.parse(a,{delimiter:","}).data,c[0].length!=c[1].length&&
(_LOG("csv parser: delimiter = , failed"),r("csv parsing error"))));c[c.length-1].length!=c[0].length&&c.pop();1==c[0].length-c[1].length&&" "==c[0][c[0].length-1]&&c[0].pop();if(b.callback)b.callback(c,b);else return _LOG("__createDataTableObject: "+(b.options?" -> "+b.options.name:"")),this.__createDataTableObject(c,b.type,b),c=a=null,!1}};g.Feed.prototype.__doRSSImport=function(a,b){_LOG("__doRSSImport: "+a);var c=this;b.format="xml";$.ajax({type:"GET",url:a,dataType:"xml",success:function(a){c.__processRSSData(a,
b)},error:function(a,c,e){"undefined"!=typeof b&&b.error&&b.error(a,c,e)}})};g.Feed.prototype.__processRSSData=function(a,b){"xml"==b.format&&($(a).find("rss").length?this.__parseRSSData(a,b):$(a).find("feed").length?r("feed not yet supported"):$(a).find("atom").length&&r("atom not yet supported"))};g.Feed.prototype.__parseRSSData=function(a,b){var c=this;"xml"==b.format&&($(a).find("rss").attr("version"),$(a).find("channel").each(function(){var d=[],h=null;$(a).find("item").each(function(){if(!h){var a=
[];h=[];for(var b=$(this).children(),c=0;c<b.length;c++){for(var g=$(this).children()[c].nodeName;a[g];)g+="*";a[g]=g;h[c]=g}d.push(h)}a=[];for(c=0;c<h.length;c++)"enclosure"==h[c]?a.push($(this).find(h[c]+":first").attr("url")||""):a.push($(this).find(h[c]+":first").text()||"");d.push(a)});c.__createDataTableObject(d,"rss",b)}))};g.Feed.prototype.__doKMLImport=function(a,b){_LOG("__doKMLImport: "+a);var c=this;b.format="xml";$.ajax({type:"GET",url:a,dataType:"xml",success:function(a){c.__processKMLData(a,
b)},error:function(a,c,e){"undefined"!=typeof b&&b.error&&b.error(a,c,e)}})};g.Feed.prototype.__processKMLData=function(a,b){"xml"==b.format&&($(a).find("kml").length?this.__parseKMLData(a,b):r("feed not kml"))};g.Feed.prototype.__parseKMLData=function(a,b){if("xml"==b.format){$(a).find("kml").attr("xmlns");var c=[],d=null;$(a).find("Document").find("Placemark").each(function(){var a=$(this).find("ExtendedData")||$(this);d||(d=[],a.find("Data").each(function(){d.push($(this).attr("name"))}),$(this).find("Point").find("coordinates")&&
d.push("KML.Point"),c.push(d));var b=[];a.find("Data").each(function(){b.push($(this).find("value").text())});$(this).find("Point").find("coordinates")&&b.push($(this).find("Point").find("coordinates").text());c.push(b)});this.__createDataTableObject(c,"kml",b)}};g.Feed.prototype.__doJSONImport=function(a,b){var c=this;$.get(a,function(a){c.__processJsonData(a,b)}).fail(function(a){"undefined"!=typeof b&&b.error&&b.error(a)})};g.Feed.prototype.__processJsonData=function(a,b){if("string"==typeof a)try{var c=
JSON.parse(a)}catch(w){this.__createDataTableObject([],"json",b)}else c=a;this.data=c;var d=[],h=[];if(c&&c.data&&c.data.columns&&c.data.rows){a=c.data.columns;c=c.data.rows;for(var e in a)h.push(a[e]);d.push(h);for(e=0;e<c.length;e++){h=[];for(var g in c[0])h.push(c[e][g]);d.push(h)}}else{c&&c.data&&(c=c.data);"array"!==typeof c&&(c=function(a){function b(a){if(Array.isArray(a))c.push(a);else if("object"===typeof a&&null!==a)for(var d in a)a.hasOwnProperty(d)&&b(a[d])}var c=[];b(a);return c}(c)[0]);
if(!c){d=[];d.push(["unknown type"]);h=a.split("\n");for(e in h)d.push([h[e]]);this.__createDataTableObject(d,"json",b);return}for(var f in c[0])if("object"==typeof c[0][f]&&null!=c[0][f])for(var n in c[0][f])if("object"==typeof c[0][f][n])for(var l in c[0][f][n])h.push(f+"."+n+"."+l);else h.push(f+"."+n);else h.push(f);d.push(h);for(e=0;e<c.length;e++){h=[];for(f in c[0])if(null===c[e][f])h.push("null");else if("object"==typeof c[e][f])for(n in c[0][f])if(c[e][f][n]&&"object"==typeof c[e][f][n])for(l in c[0][f][n])h.push(c[e][f][n][l]);
else h.push(c[e][f][n]);else h.push(c[e][f]);d.push(h)}}this.__createDataTableObject(d,"json",b)};g.Feed.prototype.__doGeoJSONImport=function(a,b){var c=this;$.get(a,function(a){c.__processGeoJsonData(a,b)}).fail(function(a){"undefined"!=typeof b&&b.error&&b.error(a)})};g.Feed.prototype.__processGeoJsonData=function(a,b){if("string"==typeof a)try{var c=JSON.parse(a)}catch(u){this.__createDataTableObject([],"json",b)}else c=a;this.data=c;a=[];var d=[],h=[];if(c&&c.features&&c.features.length){for(e=
0;e<c.features.length;e++)for(p in c.features[e].properties)h[p]=!0;for(p in h)d.push(p);d.push("geometry");a.push(d);for(var e=0;e<c.features.length;e++){d=[];for(p=0;p<a[0].length-1;p++)"object"===typeof c.features[e].properties[a[0][p]]?d.push(JSON.stringify(c.features[e].properties[a[0][p]]||"")):d.push(c.features[e].properties[a[0][p]]||"");d.push(JSON.stringify(c.features[e].geometry));a.push(d)}}this.__createDataTableObject(a,"json",b)};g.Feed.prototype.__processGeoJsonData_expandProperty=
function(a,b){if("string"==typeof a)try{var c=JSON.parse(a)}catch(u){this.__createDataTableObject([],"json",b)}else c=a;this.data=c;a=[];var d=[],h=[];if(c&&c.features&&c.features.length){for(e=0;e<c.features.length;e++)for(p in c.features[e].properties)if("string"===typeof c.features[e].properties[p]||"number"===typeof c.features[e].properties[p])h[p]=!0;else for(pp in c.features[e].properties[p])h[p+"."+pp]=!0;for(p in h)d.push(p);d.push("geometry");a.push(d);for(var e=0;e<c.features.length;e++){d=
[];for(p=0;p<a[0].length-1;p++)h=a[0][p].split("."),2<=h.length?d.push(c.features[e].properties[h[0]][h[1]]||""):d.push(c.features[e].properties[a[0][p]]||"");d.push(JSON.stringify(c.features[e].geometry));a.push(d)}}this.__createDataTableObject(a,"json",b)};g.Feed.prototype.__doTopoJSONImport=function(a,b){var c=this;$.get(a,function(a){c.__processTopoJsonData(a,b)}).fail(function(a){"undefined"!=typeof b&&b.error&&b.error(a)})};g.Feed.prototype.__processTopoJsonData=function(a,b){if("undefined"==
typeof topojson)r("'"+b.type+"' parser not loaded !");else{if("string"==typeof a)try{var c=JSON.parse(a)}catch(h){this.__createDataTableObject([],"json",b)}else c=a;this.data=c;a=null;if(b.options&&b.options.name&&c.objects[b.options.name])a=topojson.feature(c,c.objects[b.options.name]);else for(d in c.objects){a=topojson.feature(c,c.objects[d]);break}for(var d in a.features)a.features[d].properties.id=a.features[d].id;this.__processGeoJsonData(a,b)}};g.Feed.prototype.__createDataTableObject=function(a,
b,c){a&&(this.dbtable=(new g.Table).setArray(a),"undefined"!=typeof c&&c.success?c.success(this.dbtable):_LOG("callback to call on succes is 'undefined'!"))};g.Table=function(a){a?(this.table=a.table,this.fields=a.fields,this.records=a.records):(this.table={records:0,fields:0},this.fields=[],this.records=[])};g.Table.prototype={getArray:function(){var a=[[]],b;for(b in this.fields)a[0].push(this.fields[b].id);for(b=0;b<this.records.length;b++)a.push(this.records[b]);return a},setArray:function(a){this.fields=
[];for(var b in a[0])this.fields.push({id:(a[0][b]||" ").trim(),typ:0,width:60,decimals:0});a.shift();this.records=[];for(var c in a)a[c].length==this.fields.length&&this.records.push(a[c]);this.table={records:this.records.length,fields:this.fields.length};return this},revert:function(){for(var a=[],b=this.records.length-1;0<=b;b--)a.push(this.records[b]);this.records=a;return this},reverse:function(){for(var a=[],b=this.records.length-1;0<=b;b--)a.push(this.records[b]);this.records=a;return this},
columnNames:function(){var a=[],b;for(b in this.fields)a.push(this.fields[b].id);return a},columnIndex:function(a){for(var b in this.fields)if(this.fields[b].id==a)return b;return null},column:function(a){for(var b in this.fields)if(this.fields[b].id==a)return a=new g.Column,a.index=b,a.table=this,a;return null},lookupArray:function(a,b){var c="overwrite";a&&a.key&&(c=a.calc||c,b=a.key,a=a.value);var d=[];this.column(b)||alert("'"+b+"' column not found!");this.column(a)||alert("'"+a+"' column not found!");
b=this.column(b).values();a=this.column(a).values();if("sum"==c)for(i in b)d[String(b[i])]=(d[String(b[i])]||0)+a[i];else if("max"==c)for(i in b)d[String(b[i])]=Math.max(d[String(b[i])]||0,a[i]);else for(i in b)d[String(b[i])]=a[i];return d},lookupStringArray:function(a,b){a&&a.key&&(b=a.key,a=a.value);var c=[];this.column(b)||alert("'"+b+"' column not found!");this.column(a)||alert("'"+a+"' column not found!");b=this.column(b).values();a=this.column(a).values();for(i in b)c[String(b[i])]=c[String(b[i])]?
c[String(b[i])]+", "+a[i]:a[i];return c},lookup:function(a,b){var c=b.value;b=b.lookup;var d=c+"_"+b;this.lookupsA&&this.lookupsA[d]||(this.lookupsA=this.lookupsA||[],this.lookupsA[d]=this.lookupArray(c,b));return this.lookupsA[d][a]||"-"},addColumn:function(a,b){if(!a.destination)return alert("'data.addColumn' no destination defined!"),null;var c=null;if(a.source){for(var d in this.fields)this.fields[d].id==a.source&&(c=d);if(null==c)return alert("'data.addColumn' source column '"+a.source+"' not found!"),
null}this.fields.push({id:String(a.destination),created:!0});this.table.fields++;if(b&&"function"==typeof b)for(var h in this.records)this.records[h].push(null!=c?b(this.records[h][c]):b(this.records[h]));else if(b&&"object"==typeof b)for(h in this.records)this.records[h].push(b[h]||0);else if(a.values&&"object"==typeof a.values)for(h in this.records)this.records[h].push(a.values[h]||0);else for(h in this.records)this.records[h].push(0);return this},addRow:function(a){if(!a||"object"!==typeof a)return alert("'data.addRow' no options defined!"),
null;var b=[],c;for(c in this.fields)b.push(" ");for(c in a)this.column(c)?b[this.column(c).index]=a[c]:alert("'data.addRow' column '"+c+"' not found!");this.records.push(b);this.table.records++;return this},filter:function(a){this.selection=new g.Table;for(var b in this.records)a&&a(this.records[b])&&(this.selection.records.push(this.records[b]),this.selection.table.records++);this.selection.fields=this.fields.slice();this.selection.table.fields=this.table.fields;return this.selection},select:function(a){if(a.match(/WHERE/)){for(var b=
a.split("WHERE")[1].trim().split(" "),c=0;c<b.length;c++)if(b[c].length){if('"'==b[c][0]&&'"'!=b[c][b[c].length-1]){do b[c]=b[c]+" "+b[c+1],b.splice(c+1,1);while('"'!=b[c][b[c].length-1])}if("("==b[c][0]&&")"!=b[c][b[c].length-1]){do b[c]=b[c]+" "+b[c+1],b.splice(c+1,1);while(")"!=b[c][b[c].length-1])}}else b.splice(c,1),c--;this.filterQueryA=[];var d={},h="";do{var e=0;3<=b.length&&(d={},d.szSelectionField=b[0].replace(/("|)/g,""),d.szSelectionOp=b[1],d.szSelectionValue=b[2].replace(/("|)/g,""),
e=3);"BETWEEN"==d.szSelectionOp&&5<=b.length&&"AND"==b[3]&&(d.szSelectionValue2=b[4],e=5);if(e){for(c=0;c<this.fields.length;c++)this.fields[c].id==d.szSelectionField&&(d.nFilterFieldIndex=c),"$"+this.fields[c].id+"$"==d.szSelectionValue&&(d.nFilterValueIndex=c);d.szCombineOp=h;this.filterQueryA.push(d);b.splice(0,e)}else{r("data.js - selection error - incomplete query!\nquery: "+a);break}if(b.length&&"AND"==b[0])h="AND",b.splice(0,1);else if(b.length&&"OR"==b[0])h="OR",b.splice(0,1);else break}while(b.length);
this.selection=new g.Table;for(var f in this.filterQueryA)if("undefined"===typeof this.filterQueryA[f].nFilterFieldIndex)return this.selection.fields=this.fields.slice(),this.selection.table.fields=this.table.fields,_LOG("Selection: invalid query: "+a),this.selection;for(var k in this.records){a=null;for(f in this.filterQueryA)this.__szValue=String(this.records[k][this.filterQueryA[f].nFilterFieldIndex]),this.__szSelectionOp=this.filterQueryA[f].szSelectionOp.toUpperCase(),this.__szSelectionValue=
this.filterQueryA[f].szSelectionValue,this.__szSelectionValue2=this.filterQueryA[f].szSelectionValue2,this.__szCombineOp=this.filterQueryA[f].szCombineOp,null!=this.filterQueryA[f].nFilterValueIndex&&(this.__szSelectionValue=String(this.records[k][this.filterQueryA[f].nFilterValueIndex])),b=__scanValue(this.__szValue),b="="==this.__szSelectionOp?"*"==this.__szSelectionValue?""!=this.__szValue.replace(/ /g,""):this.__szValue==this.__szSelectionValue||b==Number(this.__szSelectionValue):"<>"==this.__szSelectionOp?
!(this.__szValue==this.__szSelectionValue||b==Number(this.__szSelectionValue)):">"==this.__szSelectionOp?b>Number(this.__szSelectionValue):"<"==this.__szSelectionOp?b<Number(this.__szSelectionValue):">="==this.__szSelectionOp?b>=Number(this.__szSelectionValue):"<="==this.__szSelectionOp?b<=Number(this.__szSelectionValue):"LIKE"==this.__szSelectionOp?"*"==this.__szSelectionValue?this.__szValue.length:eval("this.__szValue.match(/"+this.__szSelectionValue.replace(/\//gi,"\\/")+"/i)"):"NOT"==this.__szSelectionOp?
!eval("this.__szValue.match(/"+this.__szSelectionValue.replace(/\//gi,"\\/")+"/i)"):"IN"==this.__szSelectionOp?eval("this.__szSelectionValue.match(/\\("+this.__szValue+"\\,/)")||eval("this.__szSelectionValue.match(/\\,"+this.__szValue+"\\,/)")||eval("this.__szSelectionValue.match(/\\,"+this.__szValue+"\\)/)"):"BETWEEN"==this.__szSelectionOp?b>=Number(this.__szSelectionValue)&&b<=Number(this.__szSelectionValue2):eval("this.__szValue.match(/"+this.__szSelectionValue.replace(/\//gi,"\\/")+"/i)"),a="AND"==
this.__szCombineOp?a&&b:a||b;a&&(this.selection.records.push(this.records[k].slice()),this.selection.table.records++)}}this.selection.fields=this.fields.slice();this.selection.table.fields=this.table.fields;return this.selection},aggregate:function(a,b){var c=!1;a.lead&&(c=a.calc&&"mean"==a.calc,b=a.lead,a=a.column||a.value);b=b.split("|");for(var d=[],h=null,e=0;e<b.length;e++)for(var f=0;f<this.fields.length;f++)this.fields[f].id==b[e]&&(d[e]=f),this.fields[f].id==a&&(h=f);this.aggregation=new g.Table;
xRecords=[];xCount=[];for(var k in this.records){xField="";for(e=0;e<d.length;e++)xField+=this.records[k][d[e]];if(xRecords[xField])xRecords[xField][d.length]+=__scanValue(this.records[k][h]),xCount[xField][d.length]++;else{xRecords[xField]=[];xRecords[xField][d.length]=__scanValue(this.records[k][h]);for(e=0;e<d.length;e++)xRecords[xField][e]=this.records[k][d[e]];xCount[xField]=[];xCount[xField][d.length]=1}}for(k in xRecords)c&&(xRecords[k][d.length]/=xCount[k][d.length]),this.aggregation.records.push(xRecords[k]),
this.aggregation.table.records++;c=[];for(e=0;e<b.length;e++)c[e]={id:b[e]};c[b.length]={id:a};this.aggregation.fields=c;this.aggregation.table.fields=c;return this.aggregation},condense:function(a,b){var c={},d=[];a&&a.lead&&(b=a,a=b.lead);a=this.columnIndex(a);if(b&&b.keep)if("string"==typeof b.keep)d[this.columnIndex(b.keep)]=!0;else for(i=0;i<b.keep.length;i++)d[this.columnIndex(b.keep[i])]=!0;for(var h=[],e=0;e<this.records.length;e++){var g=String(this.records[e][a]);if(null!=c[g])for(v in g=
c[g],this.records[e]){if(!d[v])if(!isNaN(this.records[e][v]))h[g][v]=b&&"max"==b.calc?Math.max(Number(h[g][v]),Number(this.records[e][v])):Number(h[g][v])+Number(this.records[e][v]);else if(isNaN(this.records[e][v])&&h[g][v]!=this.records[e][v]){var f=parseFloat(String(h[g][v]).split(" (+")[1])||0;h[g][v]=String(h[g][v]).split(" (+")[0]+" (+"+ ++f+") "}}else h.push(this.records[e].slice()),c[g]=h.length-1}this.records=h.slice();return this},groupColumns:function(a){var b=a.source,c=[];for(i in b)c[i]=
this.column(b[i]).index;this.addColumn({destination:a.destination},function(a){var b=0;for(i in c)b+=Number(a[c[i]]);return b});return this},pivot:function(a){a.lead=a.lead||a.rows;a.cols=a.cols||a.columns;a.keep=a.keep||[];a.sum=a.sum||[];a.lead=__toArray(a.lead);a.cols=__toArray(a.cols);a.keep=__toArray(a.keep);a.sum=__toArray(a.sum);a.value=__toArray(a.value);a.forced=__toArray(a.forced);for(var b=[],c=0;c<this.fields.length;c++)b[String(this.fields[c].id)]=c;for(c in a.lead)"undefined"==typeof b[a.lead[c]]&&
r("data.pivot - pivot keep column '"+a.lead[c]+"' not found");for(c in a.cols)a.cols&&"undefined"==typeof b[a.cols[c]]&&r("data.pivot - pivot columns source column '"+a.cols[c]+"' not found");for(c in a.keep)"undefined"==typeof b[a.keep[c]]&&r("data.pivot - pivot keep column '"+a.keep[c]+"' not found");for(c in a.sum)"undefined"==typeof b[a.sum[c]]&&r("data.pivot - pivot sum column '"+a.sum[c]+"' not found");for(c in a.value)"undefined"==typeof b[a.value[c]]&&r("data.pivot - pivot value column '"+
a.value[c]+"' not found");var d=[],h=[],e=this.records;if(a.forced)for(c in a.forced)console.log(a.forced[c]),h[String(a.forced[c])]=0;for(var f=0;f<e.length;f++){var k=String(e[f][b[a.lead[0]]]);for(c=1;c<a.lead.length;c++)k+="|"+e[f][b[a.lead[c]]];var n=String(e[f][b[a.cols[0]]]);if("string"==a.calc)var l=e[f][b[a.value[0]]];else if(l=1,a.value&&a.value.length)for(c=l=0;c<a.value.length;c++)l+=a.value[c]?__scanValue(e[f][b[a.value[c]]]):1;if(!n||1>n.length)n="undefined";"undefined"==typeof h[n]&&
(h[n]=0);if(d[k]){for(c=0;c<a.keep.length;c++)e[f][b[a.keep[c]]]&&e[f][b[a.keep[c]]].length&&d[k][a.keep[c]]!=e[f][b[a.keep[c]]]&&(d[k][a.keep[c]]=e[f][b[a.keep[c]]]);for(c=0;c<a.sum.length;c++)d[k][a.sum[c]]+=Number(e[f][b[a.sum[c]]])}else{d[k]={Total:0};for(c=0;c<a.keep.length;c++)d[k][a.keep[c]]=e[f][b[a.keep[c]]];for(c=0;c<a.sum.length;c++)d[k][a.sum[c]]=Number(e[f][b[a.sum[c]]])}d[k].Total+=l;d[k][n]?"max"==a.calc?d[k][n]=Math.max(l,d[k][n]):(d[k][n]+=l,d[k][n+"count"]++):(d[k][n]=l,d[k][n+"count"]=
1)}this.__pivot=new g.Table;for(c=0;c<a.lead.length;c++)this.__pivot.fields.push({id:a.lead[c]});for(c=0;c<a.keep.length;c++)this.__pivot.fields.push({id:a.keep[c]});for(c=0;c<a.sum.length;c++)this.__pivot.fields.push({id:a.sum[c]});for(var m in h)this.__pivot.fields.push({id:m});this.__pivot.fields.push({id:"Total"});for(m in d){b=[];e=m.split("|");for(c=0;c<e.length;c++)b.push(e[c]);for(c=0;c<a.keep.length;c++)b.push(d[m][a.keep[c]]);for(c=0;c<a.sum.length;c++)b.push(d[m][a.sum[c]]);for(var q in h)"mean"==
a.calc?b.push((d[m][q]||0)/(d[m][q+"count"]||1)):b.push(d[m][q]||0);b.push(d[m].Total);this.__pivot.records.push(b);this.__pivot.table.records++}return this.__pivot},subtable:function(a){this.__subt=new g.Table;if(a.fields){a.columns=[];for(var b=0;b<a.fields.length;b++)for(var c=0;c<this.fields.length;c++)this.fields[c].id==a.fields[b]&&a.columns.push(c)}for(b=0;b<a.columns.length;b++)this.__subt.fields.push({id:String(this.fields[a.columns[b]].id)}),this.__subt.table.fields++;for(var d in this.records){c=
[];for(b=0;b<a.columns.length;b++)c.push(this.records[d][a.columns[b]]);this.__subt.records.push(c);this.__subt.table.records++}return this.__subt},sort:function(a,b){var c=this.column(a).values(),d=0;for(a=0;a<Math.min(c.length,10);a++)isNaN(parseFloat(c[a].replace(",",".")))||d++;var f=[];if(d)for(a=0;a<c.length;a++)f.push({index:a,value:Number(c[a].replace(",","."))});else for(a=0;a<c.length;a++)f.push({index:a,value:c[a]});b&&"DOWN"==b?f.sort(function(a,b){return a.value>b.value?-1:1}):f.sort(function(a,
b){return a.value<b.value?-1:1});b=[];for(a=0;a<f.length;a++)b.push(this.records[f[a].index]);this.records=b;return this},append:function(a){if(this.table.fields.length!=a.table.fields.length)return null;for(var b=0;b<this.table.fields.length;b++)if(this.table.fields[b].id!=a.table.fields[b].id)return null;a=a.records;for(b=0;b<a.length;b++)this.records.push(a[b]);this.table.records=this.records.length;return this},json:function(){this.__json=[];for(var a in this.records){var b={},c;for(c in this.fields)b[String(this.fields[c].id)]=
this.records[a][c];this.__json.push(b)}return this.__json}};__myNumber=function(a){a=parseFloat(a.replace(/\./g,"").replace(/\,/g,"."));return isNaN(a)?0:a};__scanValue=function(a){a=String(a).match(/,/)?parseFloat(String(a).replace(/\./gi,"").replace(/,/gi,".")):parseFloat(String(a).replace(/ /gi,""));return isNaN(a)?0:a};g.Table.prototype.addTimeColumns=function(a){if(!a.source)return null;for(var b in this.fields)if(this.fields[b].id==a.source){for(var c=a.create||["date","year","month","day",
"hour"],d=0;d<c.length;d++)this.fields.push({id:String(c[d])}),this.table.fields++;var f=this.records.length,e;for(e=0;e<f;e++){var g=new Date(this.records[e][b]);for(d=0;d<c.length;d++)switch(c[d]){case "date":var k=String(g.getDate())+"."+String(g.getMonth()+1)+"."+String(g.getFullYear());this.records[e].push(k);break;case "year":this.records[e].push(g.getFullYear());break;case "month":this.records[e].push(g.getMonth()+1);break;case "day":this.records[e].push(g.getDay());break;case "hour":this.records[e].push(g.getHours())}}}return this};
g.Column=function(){this.valueA=this.index=this.table=null};g.Column.prototype={values:function(){this.valueA=[];for(var a in this.table.records)this.valueA.push(this.table.records[a][this.index]);return this.valueA},uniqueValues:function(){this.valueA=[];for(var a in this.table.records)this.valueA.push(this.table.records[a][this.index]);return this.valueA.filter(__onlyUnique)},map:function(a){for(var b in this.table.records)this.table.records[b][this.index]=a(this.table.records[b][this.index],this.table.records[b],
this.index);return this},rename:function(a){this.table.fields[this.index].id=a;return this},remove:function(){this.table.fields.splice(this.index,1);for(var a in this.table.records)this.table.records[a].splice(this.index,1);this.table.table.fields--;return this}};g.Feed.prototype.column=function(a){return this.dbtable.column(a)};g.Feed.prototype.select=function(a){return this.dbtable.select(a)};g.Feed.prototype.aggregate=function(a,b){return this.dbtable.aggregate(a,b)};g.Feed.prototype.revert=function(){return this.dbtable.revert()};
g.Feed.prototype.reverse=function(){return this.dbtable.reverse()};g.Feed.prototype.pivot=function(a){return this.dbtable.pivot(a)};g.Feed.prototype.subtable=function(a){return this.dbtable.subtable(a)};g.Feed.prototype.addTimeColumns=function(a){return this.dbtable.addTimeColumns(a)};g.Broker=function(a){this.souceQueryA=[];this.options=a||{};a&&this.parseDefinition(a);this.onNotify=function(){};this.onError=function(){}};g.Broker.prototype=new g.Feed;g.Broker.prototype={addSource:function(a,b){_LOG("Data.Broker.addSource: "+
a);this.souceQueryA.push({url:a,type:b,data:null,result:null,next:this});return this},setCallback:function(a){this.callback=a;return this},realize:function(a){this.callback=a||this.callback;for(var b in this.souceQueryA)if(this.souceQueryA[b].url&&!this.souceQueryA[b].result)return this.getData(this.souceQueryA[b]),this;this.data=[];for(b in this.souceQueryA)this.data.push(this.souceQueryA[b].data);this.callback(this.data);return this},error:function(a){this.onError=a||this.onError;return this},notify:function(a){this.onNotify=
a||this.onNotify;return this}};g.Broker.prototype.parseDefinition=function(a){this.callback=a.callback||null};g.Broker.prototype.getData=function(a){this.onNotify(a);a.feed=g.feed({source:a.url,type:a.type,options:a.next.options,parent:this}).load(function(b){a.data=b;a.data.raw=a.feed.data;this.parent.onNotify(a);a.result="success";a.next.realize()}).error(function(b){a.data=null;a.result="error";a.next.realize()})};g.Broker.prototype.setData=function(a){this.parent.__doCreateTableDataObject(a,null,
this.parent.options)};g.Feed.prototype.broker=function(a){a=new g.Broker(a);a.parent=this;return a};g.broker=function(){return new g.Broker};g.Merger=function(a){this.sourceA=[];this.options=a||{};a&&this.parseDefinition(a)};g.Merger.prototype={addSource:function(a,b){this.sourceA.push({data:a,opt:b});return this},setOutputColumns:function(a){this.outColumnsA=a;return this},realize:function(a){this.callback=a||this.callback;_LOG("DataMerger: >>>");a=[];for(i in this.sourceA){var b=this.sourceA[i];
b.opt.columns=b.opt.columns||b.data.columnNames||b.data.columnNames();b.opt.label=b.opt.label||[];b.opt.columns=__toArray(b.opt.columns);b.opt.label=__toArray(b.opt.label);this.sourceA[i].data||r("DataMerger: source '"+i+"' not found");this.sourceA[i].data[0]||(this.sourceA[i].data=this.sourceA[i].data.getArray());this.sourceA[i].data[0]||r("DataMerger: source '"+i+"' not found or not of type Array");b=[];for(ii in this.sourceA[i].data[0])for(iii in this.sourceA[i].data[0][ii]==this.sourceA[i].opt.lookup&&
(b[this.sourceA[i].opt.lookup]=ii),this.sourceA[i].opt.columns)this.sourceA[i].opt.label[iii]||(this.sourceA[i].opt.label[iii]=this.sourceA[i].opt.columns[iii]+"."+(Number(i)+1)+""),this.sourceA[i].data[0][ii]==this.sourceA[i].opt.columns[iii]&&(b[this.sourceA[i].opt.label[iii]]=ii);for(iii in this.sourceA[i].opt.columns)b[this.sourceA[i].opt.label[iii]]||_LOG("DataMerger: '"+this.sourceA[i].opt.label[iii]+"' not found");a.push(b)}b=[];for(i in this.sourceA)for(ii in this.sourceA[i].opt.label)b.push(this.sourceA[i].opt.label[ii]);
if(!this.outColumnsA)for(i in this.outColumnsA=[],b)this.outColumnsA.push(b[i]);var c=[];for(i in this.outColumnsA)for(ii in a)for(iii in a[ii])iii==this.outColumnsA[i]&&(c[iii]={input:ii,index:a[ii][iii]});for(i in this.outColumnsA)if(!c[this.outColumnsA[i]])for(ii in this.sourceA[0].data[0])this.sourceA[0].data[0][ii]==this.outColumnsA[i]&&(c[this.outColumnsA[i]]={input:0,index:ii});this.namedSourceA=[];for(i=1;i<this.sourceA.length;i++)for(this.namedSourceA[i]=[],ii=1;ii<this.sourceA[i].data.length;ii++)this.namedSourceA[i][String(this.sourceA[i].data[ii][a[i][this.sourceA[i].opt.lookup]])]=
this.sourceA[i].data[ii];b=[];b.push(this.outColumnsA);for(i=1;i<this.sourceA[0].data.length;i++){var d=String(this.sourceA[0].data[i][[a[0][this.sourceA[0].opt.lookup]]]),f=[];for(ii in this.outColumnsA){var e=c[this.outColumnsA[ii]];if(e)0==e.input?f.push(this.sourceA[0].data[i][e.index]):this.namedSourceA[e.input][d]?f.push(this.namedSourceA[e.input][d][e.index]):f.push(" ");else return r('DataMerger - missing "'+this.outColumnsA[ii]+'" in label:[...]'),null}b.push(f)}_LOG("DataMerger: done");
a=new g.Table;a.setArray(b);this.callback&&this.callback(a);return a},error:function(a){this.onError=a||this.onError;return this}};g.merger=function(){return new g.Merger};console.log("*** data.js "+g.version+" ***");var r=function(a){console.log("data.js v"+g.version+": "+a)}})(window,document);
